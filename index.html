<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Picture Taking Package Poll</title>
    
    <!-- Google Fonts: Inter & JetBrains Mono (for numbers) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@500&display=swap" rel="stylesheet">

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        mono: ['JetBrains Mono', 'monospace'],
                    },
                    colors: {
                        slate: {
                            50: '#f8fafc',
                            100: '#f1f5f9',
                            800: '#1e293b',
                            900: '#0f172a',
                        }
                    },
                    animation: {
                        'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                    }
                }
            }
        }
    </script>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Custom scrollbar */
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
        
        .glass {
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.5);
        }
        
        .gradient-bg {
            background: radial-gradient(circle at 0% 0%, #eef2ff 0%, transparent 50%), 
                        radial-gradient(circle at 100% 100%, #f0fdf4 0%, transparent 50%);
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-900 gradient-bg min-h-screen relative">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        // --- Icons ---
        const IconBase = ({ size = 24, className = "", children }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>{children}</svg>
        );
        const Activity = (props) => <IconBase {...props}><path d="M22 12h-4l-3 9L9 3l-3 9H2"/></IconBase>;
        const RefreshCw = ({ className, ...props }) => <IconBase className={className} {...props}><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"/><path d="M21 3v5h-5"/><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"/><path d="M8 16H3v5"/></IconBase>;
        const Settings = (props) => <IconBase {...props}><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.09a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/><circle cx="12" cy="12" r="3"/></IconBase>;
        const HelpCircle = (props) => <IconBase {...props}><circle cx="12" cy="12" r="10"/><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"/><path d="M12 17h.01"/></IconBase>;
        const AlertCircle = (props) => <IconBase {...props}><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></IconBase>;
        const Clock = (props) => <IconBase {...props}><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></IconBase>;
        const QrCode = (props) => <IconBase {...props}><rect x="3" y="3" width="7" height="7"></rect><rect x="14" y="3" width="7" height="7"></rect><rect x="14" y="14" width="7" height="7"></rect><rect x="3" y="14" width="7" height="7"></rect></IconBase>;
        const Trophy = (props) => <IconBase {...props}><path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6"/><path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18"/><path d="M4 22h16"/><path d="M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22"/><path d="M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22"/><path d="M18 2H6v7a6 6 0 0 0 12 0V2Z"/></IconBase>;

        // --- Helper: Simple CSV Parser ---
        const parseCSV = (text) => {
            const rows = [];
            let currentRow = [];
            let currentField = '';
            let inQuotes = false;
            for (let i = 0; i < text.length; i++) {
                const char = text[i];
                const nextChar = text[i + 1];
                if (char === '"') {
                    if (inQuotes && nextChar === '"') { currentField += '"'; i++; } else { inQuotes = !inQuotes; }
                } else if (char === ',' && !inQuotes) {
                    currentRow.push(currentField.trim()); currentField = '';
                } else if ((char === '\n' || char === '\r') && !inQuotes) {
                    if (currentField || currentRow.length > 0) { currentRow.push(currentField.trim()); rows.push(currentRow); currentRow = []; currentField = ''; }
                    if (char === '\r' && nextChar === '\n') i++;
                } else { currentField += char; }
            }
            if (currentField || currentRow.length > 0) { currentRow.push(currentField.trim()); rows.push(currentRow); }
            return rows;
        };

        // --- Helper: URL Transformer ---
        const transformSheetUrl = (url) => {
            if (!url) return '';
            if (url.includes('output=csv') || url.includes('format=csv')) return url;
            const idMatch = url.match(/\/d\/([a-zA-Z0-9-_]+)/);
            const gidMatch = url.match(/[#&?]gid=([0-9]+)/);
            if (idMatch) {
                const id = idMatch[1];
                const gid = gidMatch ? gidMatch[1] : '0'; 
                return `https://docs.google.com/spreadsheets/d/${id}/export?format=csv&gid=${gid}`;
            }
            return url;
        };

        // --- Custom UI Components ---

        const Card = ({ children, className = "" }) => (
            <div className={`bg-white/80 backdrop-blur-sm rounded-2xl border border-slate-100 shadow-sm hover:shadow-xl transition-all duration-300 ${className}`}>
                {children}
            </div>
        );

        const Badge = ({ children, color = "indigo" }) => {
            const colors = {
                blue: "bg-blue-50 text-blue-700 ring-1 ring-blue-600/10",
                indigo: "bg-indigo-50 text-indigo-700 ring-1 ring-indigo-600/10",
                green: "bg-emerald-50 text-emerald-700 ring-1 ring-emerald-600/10",
            };
            return (
                <span className={`px-2.5 py-1 rounded-full text-[10px] font-semibold uppercase tracking-wide ${colors[color] || colors.indigo}`}>
                {children}
                </span>
            );
        };

        // --- Countdown Component (Moved OUTSIDE App to prevent re-renders) ---
        const Countdown = () => {
            const [timeLeft, setTimeLeft] = useState({ days: 0, hours: 0, minutes: 0, seconds: 0 });

            useEffect(() => {
                const targetDate = new Date('2025-12-18T00:00:00');

                const calculateTime = () => {
                    const now = new Date();
                    const difference = targetDate - now;

                    if (difference > 0) {
                        const days = Math.floor(difference / (1000 * 60 * 60 * 24));
                        const hours = Math.floor((difference / (1000 * 60 * 60)) % 24);
                        const minutes = Math.floor((difference / 1000 / 60) % 60);
                        const seconds = Math.floor((difference / 1000) % 60);
                        setTimeLeft({ days, hours, minutes, seconds });
                    } else {
                        setTimeLeft({ days: 0, hours: 0, minutes: 0, seconds: 0 });
                    }
                };

                calculateTime(); // Initial call
                const interval = setInterval(calculateTime, 1000);

                return () => clearInterval(interval);
            }, []);

            const TimeBox = ({ value, label }) => (
                <div className="flex flex-col items-center">
                    <div className="bg-white/80 border border-amber-200 text-amber-600 font-mono text-xl sm:text-2xl font-bold rounded-lg w-12 sm:w-14 h-12 sm:h-14 flex items-center justify-center shadow-sm transition-all duration-300">
                        {String(value).padStart(2, '0')}
                    </div>
                    <span className="text-[10px] uppercase font-bold text-amber-700/60 mt-1">{label}</span>
                </div>
            );

            return (
                <div className="flex gap-2 sm:gap-3">
                    <TimeBox value={timeLeft.days} label="Days" />
                    <TimeBox value={timeLeft.hours} label="Hrs" />
                    <TimeBox value={timeLeft.minutes} label="Min" />
                    <TimeBox value={timeLeft.seconds} label="Sec" />
                </div>
            );
        };

        // --- Visualization Components ---

        const ModernBarChart = ({ data, color = "#6366f1" }) => {
            if (!data || data.length === 0) return <div className="h-40 flex items-center justify-center text-slate-400">No Data</div>;
            const maxVal = Math.max(...data.map(d => d.value));
            const total = data.reduce((acc, curr) => acc + curr.value, 0);

            // Added max-h-80 and overflow-y-auto to handle many sections (like 17) smoothly
            return (
                <div className="w-full flex flex-col justify-start gap-4 font-sans text-xs py-2 max-h-80 overflow-y-auto pr-2 custom-scrollbar">
                {data.map((d, i) => {
                    const widthPercent = maxVal > 0 ? (d.value / maxVal) * 100 : 0;
                    const percentOfTotal = total > 0 ? Math.round((d.value / total) * 100) : 0;
                    const isWinner = d.value === maxVal && maxVal > 0;
                    
                    return (
                    <div key={i} className="flex flex-col w-full group cursor-default">
                        <div className="flex justify-between items-end mb-1.5 px-1">
                             <div className="flex items-center gap-2 max-w-[70%]">
                                <span className={`font-medium truncate ${isWinner ? 'text-amber-600 font-bold' : 'text-slate-600'}`} title={d.label}>
                                    {d.label}
                                </span>
                                {isWinner && <Trophy size={12} className="text-amber-500" />}
                             </div>
                             <span className={`text-[10px] font-medium ${isWinner ? 'text-amber-600' : 'text-slate-400'}`}>
                                {d.value} votes ({percentOfTotal}%)
                             </span>
                        </div>
                        <div className="h-3 w-full bg-slate-100 rounded-full overflow-hidden relative">
                             <div 
                                style={{ width: `${widthPercent}%` }} 
                                className={`h-full rounded-full shadow-sm transition-all duration-700 ease-out
                                    ${isWinner 
                                        ? 'bg-gradient-to-r from-amber-400 to-orange-500 shadow-amber-500/30' 
                                        : 'bg-gradient-to-r from-indigo-500 to-purple-500 group-hover:from-indigo-400 group-hover:to-purple-400'}
                                `}
                            ></div>
                        </div>
                    </div>
                    );
                })}
                </div>
            );
        };

        const ModernDonutChart = ({ data }) => {
            if (!data || data.length === 0) return <div className="h-40 flex items-center justify-center text-slate-400">No Data</div>;

            const total = data.reduce((acc, cur) => acc + cur.value, 0);
            let accumulatedAngle = 0;
            // Modern palette
            const colors = ["#6366f1", "#8b5cf6", "#ec4899", "#f43f5e", "#10b981", "#3b82f6"];

            const radius = 50;
            const cx = 60;
            const cy = 60;
            const holeRadius = 35; // Size of donut hole

            return (
                <div className="flex flex-col sm:flex-row items-center justify-center gap-8">
                    <div className="relative w-[120px] h-[120px]">
                        <svg width="120" height="120" viewBox="0 0 120 120" className="transform -rotate-90">
                            {data.map((d, i) => {
                            const angle = (d.value / total) * 360;
                            const largeArc = angle > 180 ? 1 : 0;
                            const x1 = cx + radius * Math.cos((Math.PI * accumulatedAngle) / 180);
                            const y1 = cy + radius * Math.sin((Math.PI * accumulatedAngle) / 180);
                            accumulatedAngle += angle;
                            const x2 = cx + radius * Math.cos((Math.PI * accumulatedAngle) / 180);
                            const y2 = cy + radius * Math.sin((Math.PI * accumulatedAngle) / 180);

                            if (data.length === 1) {
                                return <circle key={i} cx={cx} cy={cy} r={radius} fill={colors[i % colors.length]} />;
                            }

                            const dPath = `M ${cx} ${cy} L ${x1} ${y1} A ${radius} ${radius} 0 ${largeArc} 1 ${x2} ${y2} Z`;
                            
                            return (
                                <path
                                key={i}
                                d={dPath}
                                fill={colors[i % colors.length]}
                                stroke="white"
                                strokeWidth="2"
                                className="hover:opacity-80 transition-opacity cursor-pointer"
                                />
                            );
                            })}
                            {/* Donut Hole */}
                            <circle cx={cx} cy={cy} r={holeRadius} fill="white" />
                        </svg>
                        {/* Center Text */}
                        <div className="absolute inset-0 flex flex-col items-center justify-center pointer-events-none">
                             <span className="text-2xl font-bold text-slate-800 leading-none">{total}</span>
                             <span className="text-[9px] text-slate-400 uppercase tracking-wider font-semibold">Votes</span>
                        </div>
                    </div>

                    <div className="flex flex-col gap-2 text-xs">
                        {data.map((d, i) => (
                        <div key={i} className="flex items-center gap-2 group">
                            <span className="w-2.5 h-2.5 rounded-full ring-2 ring-white shadow-sm" style={{ backgroundColor: colors[i % colors.length] }}></span>
                            <div className="flex flex-col">
                                <span className="text-slate-700 font-medium group-hover:text-indigo-600 transition-colors truncate max-w-[140px]" title={d.label}>{d.label}</span>
                                <span className="text-slate-400 text-[10px]">{Math.round((d.value/total)*100)}%</span>
                            </div>
                        </div>
                        ))}
                    </div>
                </div>
            );
        };

        // --- Main Application ---

        const App = () => {
            const [configMode, setConfigMode] = useState(true);
            const [sheetUrl, setSheetUrl] = useState('https://docs.google.com/spreadsheets/d/1CAZHAjzs9FzpbRY2Lg4rg6xy2V-Tl1IQR4qg5rLzFNE/export?format=csv&gid=2079606152');
            const [rawData, setRawData] = useState([]);
            const [headers, setHeaders] = useState([]);
            const [loading, setLoading] = useState(false);
            const [lastUpdated, setLastUpdated] = useState(null);
            const [error, setError] = useState(null);
            const [autoRefresh, setAutoRefresh] = useState(true);
            const [activeTab, setActiveTab] = useState('dashboard');
            const [showQr, setShowQr] = useState(false);

            // --- Mock Data Generator for Demo ---
            const loadDemoData = () => {
                setLoading(true);
                setTimeout(() => {
                const demoHeaders = ["Timestamp", "Email Address", "Satisfaction", "Department", "Comments"];
                const demoRows = [
                    ["12/12/2023 10:00:00", "alice@example.com", "5", "Sales", "Great experience!"],
                    ["12/12/2023 10:05:00", "bob@example.com", "4", "Engineering", "Good, but slow wifi."],
                    ["12/12/2023 10:15:00", "charlie@example.com", "2", "HR", "Not happy with the lunch options."],
                    ["12/12/2023 11:00:00", "diana@example.com", "5", "Sales", "Amazing!"],
                    ["12/12/2023 11:20:00", "eve@example.com", "3", "Engineering", "It's okay."],
                    ["12/12/2023 12:00:00", "frank@example.com", "5", "Sales", "Love it."],
                    ["12/12/2023 12:30:00", "grace@example.com", "1", "Marketing", "Terrible."],
                ];
                setHeaders(demoHeaders);
                setRawData(demoRows);
                setLastUpdated(new Date());
                setLoading(false);
                setConfigMode(false);
                setSheetUrl("DEMO_MODE");
                }, 800);
            };

            // --- Data Fetching ---
            const fetchData = async (isBackground = false) => {
                if (!sheetUrl) return;
                if (sheetUrl === "DEMO_MODE") {
                if (Math.random() > 0.7) {
                    const depts = ["Sales", "Engineering", "Marketing", "HR"];
                    const newRow = [
                        new Date().toLocaleString(),
                        `user${Math.floor(Math.random()*1000)}@example.com`,
                        Math.floor(Math.random() * 5 + 1).toString(),
                        depts[Math.floor(Math.random() * depts.length)],
                        "New live response!"
                    ];
                    setRawData(prev => [newRow, ...prev]); 
                    setLastUpdated(new Date());
                }
                return;
                }

                // Only show loading state on initial fetch or manual connect
                if (!isBackground) {
                    setLoading(true);
                    setError(null);
                }
                
                const targetUrl = transformSheetUrl(sheetUrl);

                try {
                let text = '';
                try {
                    const response = await fetch(targetUrl);
                    if (!response.ok) throw new Error("Direct fetch failed");
                    text = await response.text();
                } catch (directErr) {
                    console.warn("Direct fetch failed, attempting proxy...", directErr);
                    const proxyUrl = `https://api.allorigins.win/raw?url=${encodeURIComponent(targetUrl)}`;
                    const response = await fetch(proxyUrl);
                    if (!response.ok) throw new Error("Failed to fetch data.");
                    text = await response.text();
                }
                if (text.trim().startsWith('<!DOCTYPE html') || text.trim().startsWith('<html')) {
                    throw new Error("Received HTML instead of CSV. Please check sheet permissions (Must be 'Anyone with link' or 'Published').");
                }

                const parsed = parseCSV(text);
                if (parsed.length < 1) throw new Error("CSV is empty");

                setHeaders(parsed[0]);
                const dataRows = parsed.slice(1).reverse();
                setRawData(dataRows);
                setLastUpdated(new Date());
                if (!isBackground) setConfigMode(false);
                } catch (err) {
                console.error(err);
                if (!isBackground) setError(err.message || "Connection failed. Please ensure the sheet is visible to 'Anyone with the link'.");
                } finally {
                if (!isBackground) setLoading(false);
                }
            };

            // Initial load
            useEffect(() => { if (sheetUrl) fetchData(false); }, []);

            // Polling interval - pass true for background update
            useEffect(() => {
                let interval;
                if (autoRefresh && !configMode && sheetUrl) interval = setInterval(() => fetchData(true), 5000); 
                return () => clearInterval(interval);
            }, [autoRefresh, configMode, sheetUrl]);


            // --- Data Analysis ---
            const stats = useMemo(() => {
                if (!rawData.length) return { total: 0, lastResponse: 'N/A', columns: [] };

                const columnAnalysis = headers.map((header, index) => {
                const values = rawData.map(row => row[index]).filter(v => v);
                const uniqueValues = [...new Set(values)];
                
                let type = 'text';
                // Increased categorical limit to 20 to allow for sections/grades
                if (uniqueValues.length <= 20 && values.length > 0) type = 'categorical';
                if (header.toLowerCase().includes('timestamp') || header.toLowerCase().includes('date')) type = 'datetime';
                
                let counts = [];
                if (type === 'categorical') {
                    const map = values.reduce((acc, val) => {
                    acc[val] = (acc[val] || 0) + 1;
                    return acc;
                    }, {});
                    counts = Object.entries(map)
                    .map(([label, value]) => ({ label, value }))
                    .sort((a, b) => b.value - a.value); 
                }
                return { header, index, type, counts, uniqueCount: uniqueValues.length };
                });
                return {
                total: rawData.length,
                lastResponse: rawData[0] ? rawData[0][0] : 'N/A', 
                columns: columnAnalysis
                };
            }, [rawData, headers]);

            // --- Views ---

            const ConfigView = () => (
                <div className="max-w-2xl mx-auto pt-16 px-4 animate-in fade-in duration-700">
                <div className="bg-white/80 backdrop-blur-md rounded-3xl shadow-2xl p-8 border border-white/50 ring-1 ring-slate-900/5">
                    <div className="flex items-center gap-4 mb-8">
                    <div className="p-3.5 bg-gradient-to-br from-indigo-500 to-purple-600 rounded-2xl shadow-lg shadow-indigo-500/30 text-white">
                        <Activity size={32} />
                    </div>
                    <div>
                        <h1 className="text-2xl font-bold text-slate-900 tracking-tight">Setup Dashboard</h1>
                        <p className="text-slate-500 text-sm font-medium">Connect your Google Form data</p>
                    </div>
                    </div>
                    
                    <div className="space-y-6">
                    <div className="bg-indigo-50/50 p-5 rounded-2xl border border-indigo-100/50">
                        <h3 className="font-semibold text-indigo-900 mb-2 flex items-center gap-2">
                        <HelpCircle size={18} /> Quick Tips
                        </h3>
                        <p className="text-sm text-indigo-700/80 leading-relaxed">
                        If connection fails, verify your Google Sheet is set to <strong>"Anyone with the link"</strong>.
                        </p>
                    </div>

                    <div>
                        <label className="block text-sm font-semibold text-slate-700 mb-2 ml-1">Google Sheet Link</label>
                        <input 
                        type="text" 
                        placeholder="Paste URL..."
                        className="w-full p-4 bg-slate-50 border border-slate-200 rounded-xl focus:ring-4 focus:ring-indigo-500/20 focus:border-indigo-500 focus:outline-none transition-all text-sm font-medium text-slate-700 shadow-inner"
                        value={sheetUrl}
                        onChange={(e) => setSheetUrl(e.target.value)}
                        />
                    </div>

                    {error && (
                        <div className="p-4 bg-red-50 text-red-600 rounded-xl text-sm flex items-center gap-3 border border-red-100">
                        <AlertCircle size={20} /> <span className="font-medium">{error}</span>
                        </div>
                    )}

                    <div className="flex gap-4 pt-2">
                        <button 
                        onClick={() => fetchData(false)}
                        disabled={!sheetUrl}
                        className={`flex-1 py-3.5 px-6 rounded-xl font-bold text-white shadow-lg transition-all transform hover:-translate-y-0.5
                            ${sheetUrl ? 'bg-gradient-to-r from-indigo-600 to-purple-600 hover:shadow-indigo-500/25' : 'bg-slate-300 cursor-not-allowed'}
                        `}
                        >
                        {loading ? 'Connecting...' : 'Connect Now'}
                        </button>
                        <button 
                        onClick={loadDemoData}
                        className="px-8 py-3.5 rounded-xl font-bold text-indigo-600 bg-white border border-slate-200 hover:bg-slate-50 hover:border-indigo-200 transition-all shadow-sm"
                        >
                        Demo
                        </button>
                    </div>
                    </div>
                </div>
                </div>
            );

            const DashboardView = () => (
                <div className="space-y-8 animate-in slide-in-from-bottom-4 duration-700">
                
                {/* Poll Closing Notice & Vote Link */}
                <div className="relative bg-amber-50 border border-amber-100 rounded-2xl p-4 flex flex-col md:flex-row items-center justify-between gap-6 shadow-sm ring-1 ring-amber-900/5 overflow-hidden">
                     {/* Dynamic Countdown */}
                     <div className="flex items-center gap-4 z-10 w-full md:w-auto justify-center md:justify-start">
                        <div className="p-3 bg-amber-100/50 rounded-xl text-amber-600 shrink-0 hidden sm:block">
                            <Clock size={24} />
                        </div>
                        <div className="flex flex-col items-center md:items-start gap-2">
                            <p className="text-amber-900 font-bold text-sm tracking-wide uppercase">Time Remaining</p>
                            <Countdown />
                        </div>
                     </div>
                     
                     <div className="flex gap-3 z-10 w-full md:w-auto justify-center">
                        <button
                            onClick={() => setShowQr(!showQr)}
                            className="p-3.5 bg-white border border-slate-200 text-slate-600 hover:text-indigo-600 hover:border-indigo-200 rounded-xl transition-all shadow-sm hover:shadow-md"
                            title="Show QR Code"
                        >
                            <QrCode size={24} />
                        </button>
                        <a 
                            href="https://forms.gle/gwCFgAHyhBpChaKr9" 
                            target="_blank"
                            rel="noopener noreferrer" 
                            className="px-8 py-3.5 bg-gradient-to-r from-orange-600 to-red-600 hover:from-orange-500 hover:to-red-500 text-white font-extrabold rounded-xl transition-all shadow-lg shadow-orange-500/30 hover:shadow-xl hover:shadow-orange-500/50 transform hover:-translate-y-1 hover:scale-105 text-base whitespace-nowrap ring-4 ring-orange-500/20 flex items-center gap-2"
                        >
                            VOTE NOW &rarr;
                        </a>
                     </div>

                     {/* Background Pattern */}
                     <div className="absolute top-0 right-0 w-64 h-full bg-gradient-to-l from-orange-100/50 to-transparent pointer-events-none"></div>

                     {/* QR Code Popover */}
                     {showQr && (
                        <div className="absolute top-full right-4 mt-3 p-4 bg-white rounded-2xl shadow-2xl border border-slate-100 z-50 animate-in fade-in zoom-in-95 duration-200 flex flex-col items-center gap-3">
                            <div className="text-center">
                                <p className="font-bold text-slate-800 text-sm">Scan to Vote</p>
                                <p className="text-xs text-slate-500">Open Camera App</p>
                            </div>
                            <img 
                                src="https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=https://forms.gle/gwCFgAHyhBpChaKr9" 
                                alt="Voting QR Code" 
                                className="w-40 h-40 rounded-lg"
                            />
                        </div>
                     )}
                </div>

                {/* Stats Row */}
                <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <Card className="p-6 relative overflow-hidden group">
                        <div className="absolute top-0 right-0 p-4 opacity-10 group-hover:opacity-20 transition-opacity">
                            <Activity size={80} className="text-indigo-600" />
                        </div>
                        <div className="relative z-10">
                            <div className="flex items-center gap-3 mb-2">
                                <span className="p-2 bg-indigo-100 text-indigo-600 rounded-lg"><Activity size={18}/></span>
                                <p className="text-sm text-slate-500 font-semibold uppercase tracking-wider">Responses</p>
                            </div>
                            <p className="text-4xl font-bold text-slate-800 tracking-tight">{stats.total}</p>
                        </div>
                    </Card>
                    
                    <Card className="p-6 relative overflow-hidden group">
                        <div className="absolute top-0 right-0 p-4 opacity-10 group-hover:opacity-20 transition-opacity">
                            <Clock size={80} className="text-emerald-600" />
                        </div>
                        <div className="relative z-10">
                            <div className="flex items-center gap-3 mb-2">
                                <span className="p-2 bg-emerald-100 text-emerald-600 rounded-lg"><Clock size={18}/></span>
                                <p className="text-sm text-slate-500 font-semibold uppercase tracking-wider">Latest</p>
                            </div>
                            <p className="text-lg font-bold text-slate-800 mt-2 truncate">{stats.lastResponse}</p>
                        </div>
                    </Card>

                    <Card className="p-6 relative overflow-hidden group">
                        <div className="absolute top-0 right-0 p-4 opacity-10 group-hover:opacity-20 transition-opacity">
                            <RefreshCw size={80} className="text-blue-600" />
                        </div>
                        <div className="relative z-10">
                            <div className="flex items-center gap-3 mb-2">
                                <span className="p-2 bg-blue-100 text-blue-600 rounded-lg"><RefreshCw size={18} className={loading ? "animate-spin" : ""}/></span>
                                <p className="text-sm text-slate-500 font-semibold uppercase tracking-wider">Status</p>
                            </div>
                            <div className="flex items-center gap-2 mt-2">
                                <span className="relative flex h-3 w-3">
                                    <span className="animate-ping absolute inline-flex h-full w-full rounded-full bg-emerald-400 opacity-75"></span>
                                    <span className="relative inline-flex rounded-full h-3 w-3 bg-emerald-500"></span>
                                </span>
                                <p className="text-lg font-bold text-emerald-600">Active Live</p>
                            </div>
                        </div>
                    </Card>
                </div>

                {/* Charts Grid */}
                <div className="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    {stats.columns
                    .filter(col => col.type === 'categorical' && col.uniqueCount > 1)
                    .map((col) => (
                        <Card key={col.index} className="p-8 flex flex-col h-full">
                        <div className="flex justify-between items-start mb-6">
                            <h3 className="text-lg font-bold text-slate-800 leading-snug pr-4" title={col.header}>{col.header}</h3>
                            <Badge color="indigo">Poll</Badge>
                        </div>
                        
                        <div className="flex-1 min-h-[240px] flex items-center justify-center">
                            {/* Force Bar Chart for the specific package question, otherwise use heuristic */}
                            {col.header.includes("Which picture taking package do you prefer?") || col.uniqueCount > 5 ? (
                                <ModernBarChart data={col.counts} />
                            ) : (
                                <ModernDonutChart data={col.counts} />
                            )}
                        </div>
                        </Card>
                    ))}
                    {stats.columns.filter(col => col.type === 'categorical' && col.uniqueCount > 1).length === 0 && (
                    <div className="col-span-full p-12 text-center text-slate-400 bg-white/50 rounded-3xl border-2 border-dashed border-slate-200">
                        <p className="font-medium">No categorical data found to graph automatically.</p>
                    </div>
                    )}
                </div>
                </div>
            );

            const FeedView = () => (
                <Card className="overflow-hidden animate-in slide-in-from-bottom-4 duration-700 border-0 shadow-lg">
                <div className="p-5 border-b border-slate-100 flex justify-between items-center bg-white">
                    <h3 className="font-bold text-slate-800 text-lg">Live Feed</h3>
                    <span className="px-3 py-1 bg-slate-100 rounded-full text-xs font-semibold text-slate-500">Last {Math.min(rawData.length, 50)}</span>
                </div>
                <div className="overflow-x-auto">
                    <table className="w-full text-sm text-left text-slate-600">
                    <thead className="text-xs text-slate-500 uppercase bg-slate-50/80 font-bold tracking-wider">
                        <tr>
                        {headers.map((h, i) => (
                            <th key={i} className="px-6 py-4 whitespace-nowrap">{h}</th>
                        ))}
                        </tr>
                    </thead>
                    <tbody className="divide-y divide-slate-100 bg-white">
                        {rawData.slice(0, 50).map((row, i) => (
                        <tr key={i} className="hover:bg-indigo-50/30 transition-colors duration-150">
                            {row.map((cell, cellIndex) => (
                            <td key={cellIndex} className="px-6 py-4 whitespace-nowrap max-w-[240px] truncate font-medium" title={cell}>
                                {cell}
                            </td>
                            ))}
                        </tr>
                        ))}
                    </tbody>
                    </table>
                    {rawData.length === 0 && (
                    <div className="p-10 text-center text-slate-400 font-medium">No data available</div>
                    )}
                </div>
                </Card>
            );

            if (configMode) return <ConfigView />;

            return (
                <div className="pb-20 font-sans">
                {/* Glass Header */}
                <header className="glass sticky top-0 z-50 transition-all duration-300">
                    <div className="max-w-7xl mx-auto px-4 sm:px-6 h-20 flex items-center justify-between">
                    <div className="flex items-center gap-4">
                        <div className="p-2.5 bg-gradient-to-br from-indigo-600 to-violet-600 rounded-xl text-white shadow-md shadow-indigo-500/20 transform hover:rotate-6 transition-transform">
                        <Activity size={22} />
                        </div>
                        <h1 className="font-bold text-xl text-slate-900 hidden sm:block tracking-tight">Picture Taking Package Poll</h1>
                    </div>
                    
                    <div className="flex bg-slate-100/80 p-1.5 rounded-xl backdrop-blur-sm">
                        <button 
                        onClick={() => setActiveTab('dashboard')}
                        className={`px-5 py-2 rounded-lg text-sm font-semibold transition-all duration-300 ${activeTab === 'dashboard' ? 'bg-white text-indigo-600 shadow-sm' : 'text-slate-500 hover:text-slate-800'}`}
                        >
                        Dashboard
                        </button>
                        <button 
                        onClick={() => setActiveTab('feed')}
                        className={`px-5 py-2 rounded-lg text-sm font-semibold transition-all duration-300 ${activeTab === 'feed' ? 'bg-white text-indigo-600 shadow-sm' : 'text-slate-500 hover:text-slate-800'}`}
                        >
                        Data Feed
                        </button>
                    </div>

                    <div className="flex items-center gap-4">
                        <span className="text-xs font-medium text-slate-400 hidden md:block bg-white/50 px-3 py-1 rounded-full">
                        {loading ? 'Syncing...' : `Updated ${lastUpdated?.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}`}
                        </span>
                        <button 
                        onClick={() => setConfigMode(true)}
                        className="p-2.5 text-slate-400 hover:text-indigo-600 hover:bg-indigo-50 rounded-xl transition-all"
                        title="Settings"
                        >
                        <Settings size={22} />
                        </button>
                    </div>
                    </div>
                </header>

                <main className="max-w-7xl mx-auto px-4 sm:px-6 pt-10">
                    {activeTab === 'dashboard' ? <DashboardView /> : <FeedView />}
                </main>

                <footer className="max-w-7xl mx-auto px-6 py-10 text-center text-xs font-medium text-slate-400">
                    <p>Live Dashboard &bull; Updates every 5s &bull; Secure Connection</p>
                </footer>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
